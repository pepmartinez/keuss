"use strict";(self.webpackChunkkeuss_docusaurus=self.webpackChunkkeuss_docusaurus||[]).push([[5466],{3905:(t,e,a)=>{a.d(e,{Zo:()=>m,kt:()=>u});var r=a(7294);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,r,n=function(t,e){if(null==t)return{};var a,r,n={},i=Object.keys(t);for(r=0;r<i.length;r++)a=i[r],e.indexOf(a)>=0||(n[a]=t[a]);return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)a=i[r],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(n[a]=t[a])}return n}var s=r.createContext({}),p=function(t){var e=r.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):o(o({},e),t)),a},m=function(t){var e=p(t.components);return r.createElement(s.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},g=r.forwardRef((function(t,e){var a=t.components,n=t.mdxType,i=t.originalType,s=t.parentName,m=l(t,["components","mdxType","originalType","parentName"]),g=p(a),u=n,c=g["".concat(s,".").concat(u)]||g[u]||d[u]||i;return a?r.createElement(c,o(o({ref:e},m),{},{components:a})):r.createElement(c,o({ref:e},m))}));function u(t,e){var a=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var i=a.length,o=new Array(i);o[0]=g;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:n,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}g.displayName="MDXCreateElement"},2954:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const i={title:"Supporting queues on Postgresql",author:"Pep Martinez",author_url:"https://github.com/pepmartinez",tags:["postgresql"]},o=void 0,l={permalink:"/keuss/blog/2024/06/20/postgresql-backend",editUrl:"https://github.com/pepmartinez/keuss/edit/master/website/blog/blog/2024-06-20-postgresql-backend.md",source:"@site/blog/2024-06-20-postgresql-backend.md",title:"Supporting queues on Postgresql",description:"Version 2.0 of Keuss comes with a new member for the supported backend family: PostgreSQL can be now used as a backend",date:"2024-06-20T00:00:00.000Z",formattedDate:"June 20, 2024",tags:[{label:"postgresql",permalink:"/keuss/blog/tags/postgresql"}],readingTime:2.435,hasTruncateMarker:!1,authors:[{name:"Pep Martinez",url:"https://github.com/pepmartinez"}],frontMatter:{title:"Supporting queues on Postgresql",author:"Pep Martinez",author_url:"https://github.com/pepmartinez",tags:["postgresql"]},nextItem:{title:"Modelling queues on MongoDB - II",permalink:"/keuss/blog/2024/01/23/queues-on-mongo-part-2"}},s={authorsImageUrls:[void 0]},p=[{value:"Functionality",id:"functionality",level:2},{value:"Requisites",id:"requisites",level:2},{value:"Performance",id:"performance",level:2}],m={toc:p};function d(t){let{components:e,...a}=t;return(0,n.kt)("wrapper",(0,r.Z)({},m,a,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Version 2.0 of Keuss comes with a new member for the supported backend family: PostgreSQL can be now used as a backend\nto create queues in tables of this RDBMS databases. Although not as performant as the other backends, we think it still\nachieve a fairly decent throughput, plus it gains the benefits of using this popular database engine:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Robust transactional support. PostgreSQL is fully ACID compliance, which may be appealing is some cases"),(0,n.kt)("li",{parentName:"ul"},"PostgreSQL has a broader adoption in tech companies, has extensive support and resources, and a strong community"),(0,n.kt)("li",{parentName:"ul"},"Reliability and maturity: PostgreSQL has been around for a long time now, and has a long track of reliability records\nwhich may be appealing to some organizations, especially risk-averse ones."),(0,n.kt)("li",{parentName:"ul"},"Strong cloud adoption")),(0,n.kt)("p",null,"Implementing it added some challenges, due to the nature of PostgreSQL, and we needed to change the way in which we initialized\nthe queue system, so we added some breaking changes to ",(0,n.kt)("inlineCode",{parentName:"p"},"factory.queue()")," method, which is now asynchronous, and requires a callback."),(0,n.kt)("h2",{id:"functionality"},"Functionality"),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"postgres")," backend functionality is on par with that of ",(0,n.kt)("inlineCode",{parentName:"p"},"mongo"),":"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"at-least-once (reserve-commit-rollback) with optional delays on rollback"),(0,n.kt)("li",{parentName:"ul"},"scheduling (with no interference or degradation)"),(0,n.kt)("li",{parentName:"ul"},"removal of elements by id")),(0,n.kt)("h2",{id:"requisites"},"Requisites"),(0,n.kt)("p",null,"In order to implement a Keuss queue using PostgreSQL as backend, you only need to provide an user with access to a PostgreSQL database with granted permissions to create tables and indexes on the database, as well as connection, query and update permissions over the tables in the db"),(0,n.kt)("h2",{id:"performance"},"Performance"),(0,n.kt)("p",null,"Performance is far from that provided by mongo or redis backends, but it's still quite impressive for a SQL backend: it operates at a few hundred queue-ops per second"),(0,n.kt)("p",null,"Here's a quite simple test comparison: we're running everything in ",(0,n.kt)("inlineCode",{parentName:"p"},"localhost")," (i.e.: no latency), using 3 concurrent clients on a intel i5 gen8; we push 100K messages and then pop them (one run with at-most-once ",(0,n.kt)("inlineCode",{parentName:"p"},"pop()"),", another run with at-least-once ",(0,n.kt)("inlineCode",{parentName:"p"},"reserve()+commit()"),"):"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"backend"),(0,n.kt)("th",{parentName:"tr",align:"left"},"op"),(0,n.kt)("th",{parentName:"tr",align:"right"},"time"),(0,n.kt)("th",{parentName:"tr",align:"right"},"TPS"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"mongo"),(0,n.kt)("td",{parentName:"tr",align:"left"},"push"),(0,n.kt)("td",{parentName:"tr",align:"right"},"16s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"6250")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"pop"),(0,n.kt)("td",{parentName:"tr",align:"right"},"30s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"3333")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"rsv+commit"),(0,n.kt)("td",{parentName:"tr",align:"right"},"51s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"1960")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"redis-oq"),(0,n.kt)("td",{parentName:"tr",align:"left"},"push"),(0,n.kt)("td",{parentName:"tr",align:"right"},"5s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"20000")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"pop"),(0,n.kt)("td",{parentName:"tr",align:"right"},"6s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"16666")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"rsv+commit"),(0,n.kt)("td",{parentName:"tr",align:"right"},"12s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"8888")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"redis-list"),(0,n.kt)("td",{parentName:"tr",align:"left"},"push"),(0,n.kt)("td",{parentName:"tr",align:"right"},"4s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"25000")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"pop"),(0,n.kt)("td",{parentName:"tr",align:"right"},"5s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"20000")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"rsv+commit"),(0,n.kt)("td",{parentName:"tr",align:"right"},"n/a"),(0,n.kt)("td",{parentName:"tr",align:"right"},"n/a")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"bucket-mongo-safe"),(0,n.kt)("td",{parentName:"tr",align:"left"},"push"),(0,n.kt)("td",{parentName:"tr",align:"right"},"3s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"33333")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"pop"),(0,n.kt)("td",{parentName:"tr",align:"right"},"6s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"16666")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"rsv+commit"),(0,n.kt)("td",{parentName:"tr",align:"right"},"4s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"25000")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"postgres"),(0,n.kt)("td",{parentName:"tr",align:"left"},"push"),(0,n.kt)("td",{parentName:"tr",align:"right"},"2m40s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"625")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"pop"),(0,n.kt)("td",{parentName:"tr",align:"right"},"2m27s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"680")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"}),(0,n.kt)("td",{parentName:"tr",align:"left"},"rsv+commit"),(0,n.kt)("td",{parentName:"tr",align:"right"},"5m35s"),(0,n.kt)("td",{parentName:"tr",align:"right"},"298")))),(0,n.kt)("p",null,"As you can see, figures for ",(0,n.kt)("inlineCode",{parentName:"p"},"postgres")," are on a lower magnitude than the others (especially redis and buckets) but they are\nstill pretty decent"))}d.isMDXComponent=!0}}]);